---
import { Icon } from 'astro-icon/components';
import TagBadge from './TagBadge.astro';
import { useTranslations } from '../i18n/utils';
import type { Lang } from '../i18n/ui';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  tags: string[];
  slug: string;
  readingTime?: number;
  lang?: Lang;
}

const { title, description, pubDate, tags, slug, readingTime, lang = 'en' } = Astro.props;
const t = useTranslations(lang);
const langPrefix = lang === 'en' ? '' : `/${lang}`;

// Format date
const dateLocale = lang === 'zh' ? 'zh-CN' : 'en-US';
const formattedDate = pubDate.toLocaleDateString(dateLocale, {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

// Estimate reading time if not provided (rough: 200 words/min)
const estimatedTime = readingTime || 5;
---

<a
  href={`${langPrefix}/blog/${slug}`}
  class="blog-card card-glow group relative block p-6 rounded-2xl border border-[var(--color-border)] bg-gradient-to-b from-[var(--color-surface-elevated)] to-[var(--color-surface)] overflow-hidden"
>
  <!-- Hover gradient overlay -->
  <div class="absolute inset-0 bg-gradient-to-br from-[var(--color-primary)]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

  <!-- Top shine -->
  <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>

  <div class="relative">
    <!-- Meta info -->
    <div class="flex items-center gap-3 mb-4 text-xs font-mono text-[var(--color-text-muted)]">
      <time datetime={pubDate.toISOString()}>
        {formattedDate}
      </time>
      <span class="w-1 h-1 rounded-full bg-[var(--color-border)]"></span>
      <span>{estimatedTime} {t('blog.minRead')}</span>
    </div>

    <!-- Title -->
    <h3 class="text-lg font-semibold text-[var(--color-text)] mb-3 group-hover:text-[var(--color-primary-light)] transition-colors duration-300 leading-snug">
      {title}
    </h3>

    <!-- Description -->
    <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-4 line-clamp-2">
      {description}
    </p>

    <!-- Tags -->
    {tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-4">
        {tags.slice(0, 3).map((tag) => (
          <TagBadge tag={tag} />
        ))}
        {tags.length > 3 && (
          <span class="px-2.5 py-1 text-xs text-[var(--color-text-muted)]">
            +{tags.length - 3}
          </span>
        )}
      </div>
    )}

    <!-- Read more indicator -->
    <div class="flex items-center gap-2 text-sm font-medium text-[var(--color-primary)] opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-0 group-hover:translate-x-1">
      <span>{t('blog.readArticle')}</span>
      <Icon name="heroicons:arrow-right" class="w-4 h-4" aria-hidden="true" />
    </div>
  </div>
</a>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
